# 1. 더 많은 것들의 변화

인터넷이 시작된 1970년대에 미국, 영국, 프랑스의 컴퓨터 업계 대표들이 모여 OSI(Open Systems Interconnection) 모델을 고안함.

### **1960년대**

- **회선 교환**에서 출발한 전화망 기술이 데이터 전송으로 발전.
- **패킷 교환** 기술이 등장: 정보를 작은 블록(패킷)으로 나눠 전송, 수신 측에서 재조립.
- **ARPANET**: 인터넷 초기 버전으로, 패킷 교환 방식을 최초로 사용한 네트워크.

### **1970년대**

- 기존 전화 사업자들은 기존 아날로그 회선을 유지하려 함.
- 이에 대항해 **분산 데이터그램 모델**이 제안되어, **OSI 모델** 개발로 이어짐.

### **1980년대**

- **OSI 참조 모델** 공개: 두 가지 패킷 스위칭 방식 포함.
- 미국 정부는 **1990년까지 OSI 표준 컴퓨터 구입**을 지시.

### **1990년대**

- **TCP/IP**는 1980년대부터 ARPANET에서 사용됨.
- OSI 표준의 복잡함과 반발로 TCP/IP는 비공식적으로 널리 확산.
- **표준화된 절차 없이도** TCP/IP 사용 가능 → 실용적 장점.

### **2000년대**

- **TCP/IP가 우세**: 모든 기기에서 통신 가능, 엔지니어들이 선호.
- OSI는 기대와 달리 확산 실패.
- TCP/IP가 인터넷의 핵심 프로토콜로 자리 잡음.
- **인터넷 통신 프로토콜의 발전**은 시간이 지나며 일부는 사라지고, 일부는 계속 남음.

수십 년 전 초기 인터넷 개척자들은 아마도 OSI가 세계를 지배할 것이라고 생각했을 것이다. 그러나 실제로는 TCP/IP가 역할을 수행했다. → 블록체인 생태계는 여전히 진화 중이므로 시간이 지남에 따라 자리잡은 인터넷 프로토콜들도 여러 가지 이유로 사라질 수 있다.

인터넷은 누구도 직접적으로 볼 수 없다. 인터넷은 웹이나 이메일과 같은 애플리케이션을 통해 볼 수 있다.
→ 블록체인도 유사함. 암호화폐 네트워크와 이를 뒷받침하는 블록체인은 본질적으로 소프트웨어와 유사함

# 2. 주목해야 할 블록체인

## 2.1 EOS

- **특징**: 자원 사용을 줄이는 모델을 도입해 수수료 없이 높은 트랜잭션 처리량 제공.
- 블록 전파기는 특수 하드웨어 구성을 사용해 블록체인 스토리지 및 스마트 계약 실행을 네트워크에서 처리한다.
    - 전파자들은 블록 생성과 지배구조에 대한 보상을 받는다.
- **합의 알고리즘**: DPoS(위임지분증명)를 채택한 제3세대 암호화폐 플랫폼.

## 2.2 카르다노

- 특징: 위임 지분 증명(PoS)을 활용한 스마트 컨트랙트 플랫폼
- 사용자는 온라인 지갑을 통해 스테이킹이 가능하며, 보상을 받기 위해 검증자에게 위임이 가능하다.
- 위임하는 동안 사용자는 멀티 서명 주소의 구조 덕분에 기본 ADA 암호화폐를 사용할 수 있다.

## 2.3 모네로

- **특징**: 트랜잭션 프라이버시와 익명성을 극대화하는 블록체인
- 세 가지 암호 전략을 구현함
    - **링 서명**: 송신자의 익명성 보호.
    - **스텔스 주소**: 수신자의 주소 숨김.
    - **링 CT (Confidential Transactions)**: 전송 금액 자체도 암호화.
- 통화 심볼: XMR

### 2.3.1 모네로 동작 방식

두 주소 간 0.5 XMR의 거래를 살펴보자.

대중에게 보이는 거래 세부사항

- 트랜잭션 ID: 7de8 ...53fl
- 블록 넘버: 2015291
- 마이너 수수료: 0.0001781
- 입력: 실제 입력 1 개와 디코이 입력 10개
- 키 이미지: bl42 ... da7e

입력은 공개적으로 볼 수 있음

<img width="500" alt="image" src="https://github.com/user-attachments/assets/86afbfc7-a62b-4dd0-aea9-73187d1bda1d" />


출력은 아래와 같음

<img width="685" alt="image" src="https://github.com/user-attachments/assets/81c19084-1f2a-4142-bd6e-01f287382673" />


**송신자의 프라이버시: 링 서명**

- 여러 입력 중 하나만 실제 송신자이며, 링 구성원을 섞어 사용.
- 예시에서는 11개의 입력 중 실제 송신자는 단 하나임.
    - 발신자가 트랜잭션을 구축할 때 다른 사람이 소유한 주소에서 무작위로 선택한 미끼 입력이 포함됨.
    - 즉, 예시에서 10개가 미끼임
    - 트랜잭션의 생성자는
- **링 키 이미지**: 중복 사용 방지를 위한 유일한 식별자 역할.

**수신자의 프라이버시: 스텔스 주소**

- 수신자의 실제 주소는 공개되지 않고, 일회성 주소가 생성됨.
- 수신자는 개인 뷰 키(Private View Key)를 이용해 본인 주소로 전송된 트랜잭션을 식별.

**전송 금액의 프라이버시: 링 CT**

- 전송 금액이 공개되지 않으며, 오직 송신자와 수신자만 확인 가능.
- 거래 내역 상에서는 두 개의 출력으로 나타나지만 금액은 암호화되어 공개되지 않음.

# 3. 스케일링 문제

앞으로 많은 연구가 수수료가 낮고 암호를 사용하기 쉬운, 효율적인 상태로 유지하면서 거래량 늘리는 데 초점을 맞출 것이다.

비트코인은 초당 3~7건의 거래만 처리할 수 있기 때문에, 확장성을 높여야한다. 

## 3.1 라이트닝

<img width="567" alt="image" src="https://github.com/user-attachments/assets/86f908b1-7015-4f40-a758-6ca0207abeba" />


비트코인은 초당 거래량 한계에 대한 해결책으로 라이트닝을 사용함. 위 그림과 같이 라이트닝은 주요 비트코인 블록체인 밖에서 서로 개방하는 채널을 사용한다.

라이트닝 네트워크는 **비트코인 블록체인 바깥에서 참여자들이 별도의 채널을 개설해 거래**를 수행할 수 있게 해주는 기술이다. (오프체인 솔루션)
블록체인의 느린 처리 속도(초당 약 7건)와 높은 수수료 문제를 해결하기 위한 **2계층 확장 솔루션(Second-layer solution)**

- **채널 개념**: 엘리스와 밥이 서로 거래하고 싶다면, 블록체인에 한 번 거래를 등록한 후 두 사람만의 채널을 열고, 그 안에서 무수히 많은 거래를 빠르고 수수료 없이 주고받을 수 있다.
    - 채널을 통해 발생한 거래는 **블록체인에 기록되지 않고 오프라인(Off-chain)으로 관리된다.**
- **종료 시 정산**: 거래가 끝난 후 채널을 닫으며, 최종 잔액만 블록체인에 기록한다.

채널 내에서 일어나는 거래의 공정성과 안정성을 보장하기 위해, **해시 타임 잠금 계약(HTLC: Hash Time Locked Contracts)**을 사용한다. 이는 거래가 일정 시간 내에 조건을 충족하지 않으면 자동으로 취소되도록 하여, 참여자 간 신뢰 없이도 거래가 가능하게 만든다.

라이트닝 네트워크를 구현하거나 개발자가 라이트닝 앱을 만들 수 있도록 도와주는 도구는 아래같은 것들이 있음.

- **c-lightning** (Blockstream 제공)
- **LND (Lightning Network Daemon)** by Lightning Labs
- **LDK (Lightning Development Kit)** by Square Crypto

정리하면, 라이트닝은 비트코인을 더 유용하게 만들기 위해 아래 확장성 문제 해결을 목적으로 함.

- **트랜잭션 속도 문제**
    - 비트코인은 초당 약 7건 처리. 수요 증가 시 네트워크 포화.
    - 라이트닝은 즉각적인 거래를 가능하게 하여 속도 문제 해결.
- **블록 생성 시간**
    - 평균 10분마다 블록 생성. 거래 확인까지 10~20분 이상 소요.
    - 라이트닝 채널 내에서는 이러한 지연 없이 거의 즉시 거래 완료 가능.
- **블록체인 크기**
    - 2020년 기준 약 285GB. 모든 노드가 전체 블록을 보관해야 하므로 확장성 문제 발생.
    - 라이트닝은 체인 밖에서 거래를 하므로 블록 크기 증가를 완화.

**라이트닝 네트워크 예시**

“엘리스가 밥에게 매일 커피 한 잔을 사주고 싶다”

**라이트닝 방식**:

- 엘리스와 밥이 **0.01 BTC로 지불 채널을 개설**.
- 엘리스는 BTC를 투자하고, 밥과 엘리스는 서로 **공동 원장을 관리**.
- 이때 제3자가 관여하지 않으며, **거래는 블록체인 외부에서 이루어짐**.
- 커피 한 잔 값만큼씩 엘리스의 지분이 줄고 밥의 지분이 증가하는 식.

→ 암호화와 채널 자금 조달에 관련된 비용은 밥과 앨리스가 정직하게 행동하도록 요구한다.

### 3.1.1 자금 트랜잭션

<img width="560" alt="image" src="https://github.com/user-attachments/assets/db257e07-3386-4ab4-b85c-7c9472d89707" />


**엘리스 → 밥으로 지불 채널 개설 과정**:

- 엘리스가 0.01 BTC를 지불 채널에 투자.
- 이 트랜잭션은 **온체인(비트코인 블록체인)** 상에서 발생하며, 멀티시그 주소로 자금이 이동.

**멀티시그 주소(multisig 2-of-2)**:

- 엘리스와 밥이 **공동으로 서명해야만** 자금이 움직일 수 있는 주소.
- 즉, 둘 다 동의하지 않으면 채널 내 자금을 이동시킬 수 없음.

이것이 **지불 채널(Payment Channel)의 기초 구조**다.

위 그림을 요약하면, 아래와 같음

1. 엘리스의 지갑 → 멀티시그 주소(지불 채널)로 0.01 BTC 전송
2. 이 주소는 Layer 1(온체인)이다.
3. 실제 거래는 이후 Layer 2(오프체인) 상에서 엘리스와 밥 간에 이루어진다.

이 구조에서 생길 수 있는 위험도 존재한다.

- 예를 들어 밥이 응답하지 않거나, 채널에서 나가버리면? → 엘리스는 자금을 되찾지 못함

이를 방지하기 위한 것이 **환불 계약**

- 스마트 계약 형태로 → 일정 시간이 지나도 밥이 응답하지 않으면, “x 블록 이후, 엘리스가 모든 자금을 환불받을 수 있도록 한다” 라는 형식의 컨트랙트가 있다.
- 이게 바로 **HTLC의 일종이며, 시간 제한과 해시값 조건을 걸어 안전한 거래 종료를 가능**하게 한다.

### 3.1.2 오프체인 트랜잭션

앞으로 앨리스와 밥은 두 서명이 모두 필요한 인출 거래를 하게된다. 
3.1.1에서 채널 개설을 하고, 자금을 예치했다. 그 결과 엘리스가 멀티 시그 주소로 **0.01BTC**를 송금한 상태

<img width="437" alt="image" src="https://github.com/user-attachments/assets/1740c254-fae2-4626-862a-06b7fcc3d130" />


자금이 들어간 멀티시그 주소에서, **누가 얼마를 가져갈지 정하는 오프체인 트랜잭션**을 만드는 것이다.
엘리스가 밥의 가게에서 0.007 BTC를 사용했다면, 멀티시그 트랜잭션은 밥에게 **0.007BTC**를 엘리스에게 **0.003BTC**를 보내야 한다.

이에 따라 아래와 같은 인출 트랜잭션이 만들어진다.

<img width="667" alt="image" src="https://github.com/user-attachments/assets/63d1f463-d49e-4618-8207-295c7d4a3719" />


오프체인의 핵심은 돈을 실제로 보내는 것이 아니라, **누가 얼마를 가져갈지를 갱신한 서명된 문서**를 계속 새로 쓰는 것.

거래가 다 끝났다고 판단되면, 둘은 마지막에 서명한 트랜잭션(#2)을 블록체인에 제출한다.

### 3.1.3 라이트닝 노드와 월렛

라이트닝 지갑은 결제 채널을 열고 닫고 라이트닝 거래를 할 수 있는 추가 기능이 있는 비트코인 지갑이다.
주의: 라이트닝 채널은 실제 BTC를 예치해야 열 수 있다. 즉, BTC 잔고가 없는 상태에서 라이트닝 채널을 열 수 없다.

라이트닝은 보안을 위해 **트랜잭션 변조 불가능한 블록체인**을 필요로 한다. 세그윗(Segregated Witness)은 **트랜잭션 본문과 서명(signature)을 분리한 비트코인 프로토콜** 업데이트이다. 
→ 과거에는 트랜잭션 안의 서명을 조작하면 트랜잭션 ID도 바꿀 수 있어서 **변조 공격** 가능성 존재했다. 하지만, 세그윗은 서명 데이터를 따로 분리하여, 거래 자체는 고정되고 공격이 불가능해졌다.

라이트닝과의 관계를 따져보면 아래와 같다.

- 라이트닝은 이전 상태의 트랜잭션 제출을 방지하기 위해 "서명된 상태"가 변경 불가능해야 함
- 즉, 세그윗은 **라이트닝을 안전하게 실행하기 위한 필수 기반 기술**임
