# 암호화폐에 내재된 가치

## 암호화폐 시스템의 공개키와 개인키

컴퓨터 네트워크의 확산과 함께 공개키(비대칭 암호화)가 발명됐다. 공개키 암호화는 수신자의 공개키로 누구나 쉽게 메시지를 암호화할 수 있고 <br>
수신자의 개인키를 사용해야만 암호화한 메시지를 해독할 수 있다. <br>
공개키 암호화 기법은 비트코인과 같은 암호화폐의 필수 요소다. <br>
예를 들어, 비트코인 지갑을 생성하면 공개키와 개인키, 비트코인 주소가 생성된다. <br>
비트코인 주소는 공개키를 변환한 것으로, 자금을 받을 수 있고 다른 주소로 보낼 수 있는 지갑의 ID다. <br>
개인키는 비밀로 유지되며 저장된 암호화폐를 잠금 해제하는 데 사용된다.

비트코인 개인키는 디지털로 거래에 서명하는 데 사용된다. 비트코인 주소의 소유자는 비트코인 네트워크에 주소의 정당한 소유자임을 증명하고, 거래가 어떻게 승인되는지 증명한다. <br>
비트코인 공개키는 비트코인 주소를 생성하는 데만 사용된다. 개인키는 무작위 생성기에 의해 생성된 256비트 숫자다. <br>
사용자가 개인키를 갖고 있다면, 공개키와 페어링해 비트코인 주소를 잠금 해제할 수 있다.

## UTXO 모델

비트코인 거래는 미지출 트랜잭션 출력이라는 독특한 방식을 따른다. <br>
이는 입력 목록과 출력 목록으로 구분되고, 각 입력은 과거에 받은 주소와 함께 자금을 제공하는 비트코인 주소가 있는 미지출 트랜잭션을 식별한다. <br>
각 출력은 비트코인 주소와 주소가 얼마나 많은 돈을 받는지 보여준다. 입력값과 출력값의 차이는 비트코인 마이너가 받게 되는 거래 수수료를 의미한다. <br>
각 입력에는 비트코인 주소의 소유자가 그 거래를 승인한다는 것을 증명하는 디지털 서명이 포함된다.

<img width="820" alt="Image" src="https://github.com/user-attachments/assets/75e293a3-04ce-4c65-9c8e-0189cd7deb18" />

아래는 로우 트랜잭션의 구성요소이다.

| 항목    | 내용                                                                 |
|-------|--------------------------------------------------------------------|
| 버전 정보 | 4바이트로 트랜잭션을 생성하는 노드가 사용하는 프로토콜 버전을 식별한다.                           |
| 플래그   | 0001 값을 나타내는 플래그가 있는 경우, 노드는 트랜잭션에서 서명 정보를 제거하는 세그윗을 사용하고 있다는 것이다. |
| 입력 개수 | 입력 개수                                                              |
| 입력 목록 | 입력된 데이터 목록                                                         |
| 출력 개수 | 출력된 데이터 개수                                                         |
| 출력 목록 | 출력된 데이터 목록                                                         |
| 증인    | 세그윗을 사용하면 필드에는 증인 목록이 표시된다.                                        |
| 잠금시간  | 4바이트로 필드가 비어 있지 않으면, 트랜잭션을 블록체인에 추가할 수 있는 가장 이른 시간을 식별한다.          |

## 트랜잭션

암호화폐에서 트랜잭션은 한 주소에서 다른 주소로의 값 이동을 나타낸다. <br>
블록체인에 게재된 트랜잭션은 컨펌됐다라고 표현한다. <br>
사용자들은 대부분의 암호화폐에서 트랜잭션이 성사되기 위해 네트워크에 수수료를 지불해야 한다. 통상 거래가 포함된 블록을 발견한 마이너에게 돌아가는 수수료는 <br>
마이너들이 지속적으로 네트워크를 보호할 수 있도록 장려하기 위한 것이다. <br>
블록에 기록할 수 있는 트랜잭션의 수에는 제한이 있으므로, 긴급성을 높이기 위해 더 높은 수수료가 필요할 수 있다.

<img width="645" alt="Image" src="https://github.com/user-attachments/assets/48c93a1e-b67b-492c-b3b9-c27d8a038741" />

### 머클루트

머클루트는 256 비트로 저장된 현재 블록의 모든 트랜잭션 상태를 스냅샷으로 보여줄 때 사용된다. <br>
머클루트를 사용하여 다른 모든 노드의 머클루트와 비교해, 전체 블록체인을 저장할 필요가 없는 가벼운 소프트웨어 클라이언트를 구축해 자체 트랜잭션을 검증할 수 있다. <br>
이를 통해 블록체인 노드에서 조작을 신속하게 감지할 수 있다는 점이 중요하다. <br>
주어진 노드의 블록체인에 어떤 변조나 부패가 생긴다면, 머클루트 해시는 더이상 다른 노드와 일치하지 않을 것이다.

### 트랜잭션 서명 및 검증

각 트랜잭션 입력에는 보내는 주소의 소유자가 트랜잭션을 승인했다는 증거를 제공하는 서명이 포함된다. <br>
서명은 개인키와 트랜잭션 데이터를 입력으로 하는 암호화 알고리즘인 ECDSA를 사용해 생성되고 암호화된다. <br>
모든 노드가 ECDSA 검증 함수를 사용해 서명의 유효성을 쉽게 검증할 수 있다. <br>
중요한 것은 트랜잭션을 허가하는 디지털 서명이 유요한지 확인하는 데는 개인키는 필요하지 않다는 점이다. <br>
모든 노드가 공개 정보를 사용해 트랜잭션을 쉽게 검증할 수 있지만 개인키가 필요하기 때문에 서명 자체를 생성할 수는 없다.

<img width="386" alt="Image" src="https://github.com/user-attachments/assets/eceda832-6b5e-474e-9e01-c919d23e0b03" /> <br>
<img width="362" alt="Image" src="https://github.com/user-attachments/assets/beffc5bc-515e-499e-acbb-5c82d3f0bbab" />

### 코인베이스 트랜잭션

모든 블록에 기록된 첫번째 트랜잭션을 코인베이스 트랜잭션이라고 한다. 코인베이스 트랜잭션은 두 가지 값으로 구성된다.

- 블록 보상
  - 마이너가 비트코인 네트워크 유지를 위해 블록 발견 작업을 수행하고, 네트워크로부터 받는 보상이다.
- 거래 수수료
  - 현재 블록에 추가되는 각 트랜잭션 수수료의 총합을 의미한다.

## 해시

해시는 블록체인에서 다음과 같은 특성이 있다.

- 입력에 관계없이 결과 해시는 항상 고정된 길이다.
- 해시는 단방향 암호화로 데이터를 쉽게 암호화할 수 있다.
- 해시를 원래 입력 데이터로 다시 해독하는 것은 불가능하지는 않지만, 매우 어렵다.
- 해시는 같은 입력 데이터가 입력될 때마다 결과 해시가 항상 같다.
- 입력 데이터에 약간의 변경이라도 결과 해시를 매우 다르게 보이게 한다.
- 같은 해시를 산출하는 두 개의 다른 입력 값을 찾을 가능성은 매우 낮다.

### 블록 해시

블록 해시는 블록이 생성되는 순간에 전체 블록체인이 어떤 모습이었는지 보여주는 스냅샷이다. <br>
모든 노드는 블록 해시를 참조해 네트워크를 보는 시각이 다른 노드와 정확히 일치하는지 확인한다. <br>
노드의 원장에 사소한 차이점이라도 있다면, 그 해시는 상당히 다르게 보일 것이다. <br>
새로운 블록 해시를 생성할 때, 이전 블록 해시를 포함해 모든 블록이 이전 블록에 연결되거나 체인화 되도록 한다.

<img width="669" alt="Image" src="https://github.com/user-attachments/assets/0b27537f-e741-4a99-b2de-fb30bd73a3d8" />


## 커스터디: 개인키는 누가 갖고 있는가

### 지갑 유형: 수탁형과 비수탁형

수탁형 지갑은 신뢰할 수 있는 엔티티에 의해 제어되며, 사용자는 일반적으로 웹 인터페이스를 통해 접근해야 한다. <br>
사이트는 사용자를 위한 개인키를 저장한다. 거래소는 수탁형 지갑의 일반적인 예다.

비수탁형 지갑은 사용자에게 열쇠를 완전히 제어할 수 있게 해준다. <br>
사용자는 개인키의 보안에 전적으로 책임이 있다. 사용자가 열쇠를 잃으면 사용자의 잠금에 완전히 접근할 수 있게 된다.

### 지갑 유형 변형

- 핫 월렛은 인터넷에 연결되어 있어 거래를 생성할 때 키를 쉽게 사용할 수 있다. (자금 이동이 쉬움)
- 콜드 월렛은 개인키가 완전히 오프라인으로 저장되는 지갑이다. 대형 암호화폐 업체들은 안전한 보관을 위해 자금 대부분을 콜드 월렛에 보관한다.
- 하드웨어 지갑은 개별 사용자에게 자금을 콜드 월렛으로 보관할 수 있게 해준다. 인터넷에 지속적으로 연결되지 않는 비수탁형 지갑으로 암호화된 키의 안전한 저장을 보장한다.
- 페이터 월렛은 개인키가 인쇄되거나 쓰이고 물리적으로 안전한 오프라인 어딘가에 저장되는 비수탁형 지갑이다.
- 웹 월렛은 브라우저를 통해 연결되는 웹사이트 기반 지갑이다.
- 데스크톱 월렛은 윈도우, 맥, 리눅스 컴퓨터에서 실행되는 소프트웨어다.
- 모바일 월렛은 앱 기반 지갑으로 안드로이드나 iOS용 앱스토어에서 확인할 수 있다.

## 채굴

### 블록 제너레이터

암호화폐는 작업 증명이라는 합의 알고리즘을 사용하기 때문에 채굴이 필요하다. <br>
비트코인은 특정 패턴과 일치하는 해시를 만들어 퍼즐을 풀기 위해 계산을 실행함으로써 작업이 증명된다. <br>
블록을 만드는 작업을 증명하는 과정을 채굴이라고 한다.

### 합의

블록체인에서 인기있는 두 가지 합의 방식은 작업 증명과 지분 증명이다. <br>
**작업 증명**은 암호화폐 트랜잭션을 확인하고 비트코인 블록체인에 블록을 넣을 수 있게 한다. <br>
작업 증명 채굴은 해시 함수를 사용해 데이터를 검증한다. 

비트코인 트랜잭션의 새로운 블록은 10분마다 한 마이너에게 확인된다. <br>
네트워크 안에 수천명의 마이너가 있으므로 네트워크는 어떤 마이너가 새로운 블록을 확인할 권리를 얻는지에 대해 합의를 이끌어 내야 한다. <br>
마이너가 새로운 블록을 발견하기 위해서는 다음을 기준으로 네트워크에서 유효한 것으로 간주되는 비트코인 블록 해시를 생성해야 한다.

1. 유효한 블록 헤더의 해시다.
2. 결과 블록 해시는 현재 네트워크 목표치보다 낮은 숫자다.

비트코인은 2016개 블록마다 네트워크의 모든 노드가 새로운 타깃을 재계산하도록 설계됐다. <br>
새로운 목표값은 정확히 10분 간격으로 이전 2016 블록을 생성한 목표값을 기준으로 계산된다. <br>
이는 비트코인 네트워크가 기존 2016개 블록에 걸쳐 네트워크에 참여한 마이너들이 유효한 블록 해시를 생성하는데 필요한 난이도를 스스로 수정하는 방식이다. <br>
난이도가 발생하는 주된 이유는 비트코인 공급이 예측 가능하고, 특정 일정을 따르도록 하기 위함이다. <br>
21만 블록마다(대략 4년) 블록 보상이 반으로 줄어든다.

### 트랜잭션 라이프 사이클

1. 브로드캐스트: 비트코인 트랜잭션을 생성한 다음 트랜잭션 내역을 비트코인 네트워크에 광범위하게 전파한다.
2. 언컨펌드/멤풀: 네트워크의 모든 마이너가 트랜잭션을 수신함에 따라 트랜잭션을 메모리풀에 배치된다. 멤풀은 컨펌되지 않은 상태이며 여전히 활성 상태인 것으로 간주되는 모든 비트코인 트랜잭션 모음이다.
3. 마이너에 의해 컨펌됨: 마이너가 새로운 블록을 발견하면, 마이너는 멤풀에 있는 트랜잭션 중에서 선택해 새 블록에 포함할 트랜잭션을 결정한다. 마이너는 가상 높은 것부터 시작해 거래 수수료 순으로 트랜잭션을 선택한다.
4. 네트워크에서 컨펌됨: 블록이 새로운 블록 아래에 묻힐수록 비트코인 네트워크가 그 블록을 포함시키는 합의를 이룰 가능성이 커진다.

### 지분 증명

채굴의 필요성을 제거해 작업 증명을 개선하는 것을 목표로 하는 합의 알고리즘이다. <br>
암호화폐 보유자들은 의결권을 얻기 위해 잔고를 걸고 거래를 검증하기 위해 네트워크에 의해 선택될 기회를 갖는다. <br>
따라서 스테이킹을 사용하면 노드 또는 validator로 역할을 수행할 수 있다.









