# 3장 - 포크와 알트체인

상태: 시작 전

암호화폐는 연구/개발 단계에 있으며 개발자들은 또 다른 비트코인을 만들기 위해 노력 중이다. 

확장성, 기능성, 투기성 등의 이유로 비트코인 코드를 분기해 비슷한 특성이 있는 새로운 암호화폐를 만들기 위한 제안이 있었다. 

## 3.1 비트코인 개선안

---

비트코인 코어는 오픈소스여서 개선을 위한 제안과 반영 과정을 거치면 끝날 것 같지만 실상은 말처럼 그리 쉽지 않다. 비트코인 프로토콜을 업데이트하려면 반드시 따라야 할 **거버넌스 프로세스**가 있다.

비트코인 개선 사항의 약자인 BIP(Bitcoin Improvement Proposals)는 소프트웨어 제품의 일반적인 개선 방식이다.. 소스를 개선하기 위한 지속적인 내부 프로세스가 있다.

비트코인 코어는 오픈소스다. 클라이언트 소프트웨어는 모든 사람에게 개방돼 있고 비트코인 커뮤니티가 소유하고 관리하도록 설계 됨. BIP는  비트코인 코어 코드를 지속적으로 관리하고 업데이트하는 커뮤니티의 과정이다. (지정된 위원회나 팀에 의해 결정되는 것이 아닌 전체 공동체에 의해 결정됨)

비트코인을 개선하기 위한 아이디어가 생기면 커뮤니티의 누구나 새로운 BIP를 제안할 수 있음

**BIP 생명주기**

- 커뮤니티의 누군가가 개선 아이디어를 제시하고 BIP 편집자에게 제안함
- 편집자가 승인하면 초안 상태에 넣기 위해 새로운 BIP를 만든다.
- 마이너들이 BIP에 관한 지지 신호를 보내면 최종 상태로 이동한다. 소프트웨어를 업그레이드해야 하기 때문에 새로운 BIP 채택에 동의해야 하는 대상은 마이너들이다.
- BIP가  최종 상태에 있다면 나머지 커뮤니티는 새로운 소프트웨어로 업그레이드 해야한다.

<img width="507" alt="image" src="https://github.com/user-attachments/assets/9a651ac4-f0db-4cab-b91b-6b1003d6a306" />


## 3.2 포크에 관한 이해

---

비트코인 커뮤니티가 네트워크의 공동 이익을 위해 함께 모이기 시작하고 점점 커지면서 많은 프로그래머들이 **소프트웨어 포크를 통해 개량한 비트코인**을 만들 수 있게 됐다. 그 결과로 **알트코인**으로 알고 있는 대체 코인들이 탄생했다. 알트코인 중 일부는 비트코인과 너무 달라 알트체인이라고 한다. 포크는 실제로 암호화폐 세계에서 다른 의미가 있는데, 다음과 같은 용어를 사용한다.

- 소프트웨어 포크
    
    기술 시스템과 오픈소스 소프트웨어의 일반적인 용어다. (포크 뜨는 행위)
    
- 소프트포크
    
    블록체인 기술과 관련해 네트워크를 변경하지만 모든 채굴자가 참여할 필요는 없는 채굴 소프트웨어의 업그레이드다.  소프트포크는 이전 소프트웨어와 호환되며 보통 트랜잭션 기능을 업그레이드하기 위해 수행된다.
    
- 하드포크
    
    블록체인 기술과 관련해 하드포크는 채굴 소프트웨어를 업그레이드해 네트워크를 바꾸는 것으로 모든 채굴자가 참여해야 한다. 주요 보안 또는 기능 변경을 구현하며 업그레이드는 이전 소프트웨어와 호환되지 않는다.
    
- 논쟁의 여지가 있는 하드포크
    
    블록체인 기술에서 논쟁의 여지가 있는 하드포크는 마이닝 소프트웨어에 대한 하위 호환성이 없는 업그레이드로서, 포크를 모두가 동의하지 않을 경우 네트워크에 변화를 준다. 일부 마이너들이 포크에 동의하지 않아 업그레이드하지 못하면, 사실상 블록체인이 둘로 갈라진다. → 과거 기록은 각 지점에서 동일하지만, 논란이 된 하드포크 시점부터 두 체인은 서로 다른 트랜잭션을 기록하고 소프트웨어도 호환되지 않는다.
    

### 3.2.1 논쟁을 불러온 하드포크

논쟁의 여지가 있는 하드포크가 발생하면 암호화폐의 메인 블록체인이 두 개로 분리된다. 아래 그림과 같이 2017년에 비트코인에서 분리된 체인 비트코인 캐시가 대표적이다.

<img width="353" alt="image" src="https://github.com/user-attachments/assets/5a50dd5c-258e-4a3f-9dac-9e5bb2c3ae46" />


각 블록체인은 **포크 이전**의 메인 블록체인의 역사를 계승한다. 기록은 이전 거래, 각 주소의 잔액, 각 블록의 해시 등을 포함한다. 포크가 발생하는 순간까지 두 블록체인은 동일한 기록을 가지고 있다. **포크 이후**에는 각 블록체인이 자체적인 새로운 블록과 새로운 트랜잭션 기록을 만들고, 블록은 서로 다른 마이너가 채굴할 수 있다.

위 그림에서 주소 A는 메인 비트코인 블록체인의 포크 앞에 100 BTC 잔액이 있다. 포크 이후 두 개의 새로운 체인이 메인 체인으로 분리돼 비트코인(BTC)과 비트코인캐시(BCH)로 나뉘었다. 주소 A는 두 신규 블록체인에 모두 잔액이 100으로 유지돼 비트코인 블록체인에 100BTC, 비트코인캐시에 100 BCH가 있다.

이전의 비트코인 체인(BTC)은 포크 코드가 제시되기 이전과 같이 여전히 존재한다. 비트코인캐시 노드가 **1MB 이상의 블록을 수용하기 시작하면 비트코인캐시 체인은 스스로 비트코인에서 벗어나 새로운 체인을 만든다**.

### 3.2.2 마이너

**마이너는 네트워크 실행을 위해 해시파워를 기여하는 사람들**이다. 이어 논쟁의 여지가 있는 하드포크가 발생하면 마이너는 **프리포크된 블록체인이 사용하는 소프트웨어를 그대로 유지**하거나 **포크된 블록체인 소프트웨어로 변경**한다.

<img width="439" alt="image" src="https://github.com/user-attachments/assets/5eeb3253-b923-41bd-ad43-4453248b8290" />

위 그림을 보자.

비트코인캐시 포크의 경우 비트코인캐시를 지원하려는 채굴자들이 #478560블록에서 소프트웨어를 비트코인 ABC v0.14.6으로 바꾸고, 새로운 네트워크에 해시파워를 기여하기 시작했다. 비트코인을 지원하려는 마이너들은 같은 비트코인 코어 클라이언트 0.14.2를 계속 사용했다.

> 해시파워는 작업 증명 기반 블록체인의 생존에 중요하다. 다중 당사자가 네트워크에 더 많은 해시파워를 기여할수록, 단일 노드가 네트워크를 통제하는 데 더 많은 비용이 들기 때문에, 네트워크가 더 탈중앙화된다. 블록체인 네트워크가 탈중앙화 될 수록 네트워크 보안에 관한 신뢰도가 높아진다.
> 

논란이 되는 포크가 발생하면 커뮤니티는 2,016개의 블록이 생성되고 나서 **해시레이트가 가장 높은 블록체인을 승리한 것을 간주한다**. 그리고, 블록체인이 포크 이름을 그대로 유지하게 된다. 프리포크 이름들은 거래소에서 블록체인에 붙여진 이름들이고 암호화폐 가격에도 큰 영향을 미치기 때문에 매우 중요하다.

오늘날, 비트코인은 커뮤니티는 비트코인, 비트코인캐시, 비트코인SV까지 세 개의 블록체인으로 나뉜다. 아래 그림처럼 비트코인의 해시레이트가 단연코 가장 높다.

<img width="714" alt="image" src="https://github.com/user-attachments/assets/6e8f8fc4-3317-4726-a041-235d7fd757d6" />

### 3.3.3 리플레이 공격

하드포크가 발생하면 두 개의 새로운 블록체인이 모두 리플레이 공격에 취약해질 수 있다. **리플레이 공격은 공격자가 한 블록체인에서 합법적인 거래의 데이터를 가져다가 두 번째 블록체인에서 해당 거래를 복제하거나 미러링할 때 발생**한다.

두 블록체인이 모두 트랜잭션 서명을 생성하는 프로세스가 정확히 같을 경우, 리플레이 공격에 취약하다. 아래 그림은 비트코인과비트코인캐시 블록체인이 리플레이 공격에 취약할 때 발생할 수 있는 상황을 보여준다.

포크 이후에 리플레이 공격이 일어나는 예시다.

<img width="530" alt="image" src="https://github.com/user-attachments/assets/478caf1b-78a8-44b2-9581-1310c063d33a" />

1. 주소 A는 주소 B로 60 BTC를 보내라는 거래 지시를 비트코인 네트워크에 브로드캐스트한다.
2. **브로드캐스트에는 트랜잭션 데이터(입력 및 출력)와 트랜잭션 서명이 포함**된다.
트랜잭션 서명은 주소 A가 개인키를 사용해 생성할 수 있으며 네트워크에 (비트코인 네트워크에서) 트랜잭션을 승인했다고 증명한다.
3. 주소 A가 거래 데이터와 거래 서명을 공개적으로 브로드캐스트했기 때문에 누구나 같은 정보를 비트코인캐시 네트워크로 브로드캐스트할 수 있다. 그리고, 두 체인이 유사하기 때문에 네트워크가 이를 처리할 것이다.

다행히 비트코인캐시 포크가 발생했을 때, 새로운 소프트웨어 비트코인캐시 마이너는 어느 블록체인에서든 리플레이 공격이 일어나지 않도록 변경사항을 포함하고 있었다.

비트코인캐시 소프트웨어는 네트워크를 통해 전송되는 트랜잭션 데이터의 구 조에 `SIHASH_FORKID`라는 새로운 필드를 추가했다. 새 필드가 유효하려면 비트코인캐 시 트랜잭션에 있어야 한다. **트랜잭션 서명이 생성될 때 암호화 알고리즘의 입력 중 하나가 트랜잭션 데이터다.**
즉, 비트코인 코어 블록체인에 생성되는 서명은 비트코인캐시 블록체인과 다르고, 다른 체인에서는 유효하지 않다.(트랜잭션 데이터가 두 블록체인에 다르게 구조화돼 있기 때문에)



### 3.2.4 비트코인캐시 포크

---

세그윗 및 라이트닝과 같은 솔루션의 구현에도 불구하고, 비트코인 커뮤니티에서는 네트워크의 확장 방식, 특히 블록 크기 문제에 불만이 있는 그룹이 존재했다. 

- **그룹 1:** 비트코인 블록 크기가 1MB로 제한되어 있지만, 이 개별 블록의 크기를 늘리는 것이 가장 쉬운 길이라고 믿음
- **그룹 2:** 세그윗과 라이트닝을 구현한 그룹. 블록 크기를 늘리면 전체 블록체인이 너무 커지고 네트워크 속도가 느려져 개인이 비트코인 코어 소프트웨어를 구동하기에는 너무 힘들다고 봤음

이 그룹 불일치는 네트워크의 탈중앙화를 방해할 우려가 있었고, 합의에 이르지 못함 → 하드포크가 마련됨

2017년 8월에 논란이 많은 하드포크가 발생하면서 비트코인캐시가 만들어졌다. 블록 크기는 8MB이었다. 2,100만 개의 채굴 한도와 SHA-256 작업 증명 등 오리지널 비트코인 체인의 다른 특징은 대부분 유지했다.

2018년 5월 32MB로 늘어난 비트코인캐시의 8MB 블록 크기는 더 많은 트랜잭션과 기능을 수용할 수 있도록 설계됨

## 3.3 리플

---

소프트웨어 포크로 비트코인 기반의 작업 증명 합의 알고리즘이 적용된 암호화폐들이 많은 비판을 받음 → 비트코인과 같은 암호화폐 네트워크에서 중앙집중화가 점점 더 많이 일어나고 있기 때문 (모든 비트코인 채굴의 65% 이상이 중국이라고 함)

풀어쓰면 아래와 같음

- 비트코인을 복사해서 만든 암호화폐들이 많아졌고, 이들도 전부 비트코인처럼 "작업 증명"이라는 방식을 사용
- 그런데 이 작업 증명 방식은 많은 컴퓨팅 파워(즉, 전기와 장비)를 필요로 함
- 이 때문에 **채굴**이라는 행위가 점점 소수의 사람이나 조직(대형 채굴장)에게 집중되기 시작 함 → "**중앙집중화**"
- 캠브리지 대안 금융 센터(Cambridge Centre for Alternative Finance) 조사에 따르면, 
**비트코인 전체 채굴의 65% 이상이 중국에서 이뤄졌다**고 함
- 즉, 비트코인은 '탈중앙화'가 목표였지만, 실제론 특정 지역(중국)에 너무 의존

일부 창업자와 기술적 특성을 공유하는 **리플은는 작업 증명 방식을 사용하지 않는 암호화폐**로 어느 정도 성공을 거뒀다.

### 3.3.1 리플

2012년에 출시된 리플은 초창기부터 가장 오랫동안 지속되는 대안 암호화폐 중 하나다. 당시 리플은 암호화폐랑 관계없는 프로젝트였다. → (초창기엔 리플페이라는 국제 송금용 서비스를 함. 이후 리플랩스라는 회사를 만들어 기존 서비스에 합의 알고리즘을 적용해 XRP라는 암호화폐를 만들었음)

리플은 **XRP 합의 프로토콜**이라는 **새로운 유형의 합의 알고리즘**을 도입. 트랜잭션에 대한 노드 합의가 필요한 **비잔틴 장애 허용 정책(BFT, Byzantine Fault Tolerant)**을 사용함

- GPT 상세 설명 내용
    
    **XRP 합의 알고리즘**
    
    - 전 세계에 여러 개의 **노드**(서버)가 있어.
    - 이 중에서 **UNL(Unique Node List)**라는 "신뢰할 수 있는 노드 목록"을 가지고 있음.
    - 트랜잭션이 들어오면, 이 UNL에 있는 노드들이 서로 통신해서 **합의(Agreement)**를 만들어.
    - 이 과정이 **매우 빠름** (4~5초면 됨) 그리고 **에너지가 적게 듦** (채굴 필요 없음)
    
    **비잔틴 장애 허용 정책**
    
    - **어떤 노드가 고장 나거나, 심지어 일부러 거짓 정보를 보내도**, 나머지 **정상적인 노드들이 다수라면** 올바른 결정을 할 수 있게 만드는 시스템이야.
    - 이게 중요한 이유는, 인터넷 같은 공개 네트워크에서는 누가 신뢰할 수 있는지 **100% 확신 못 하거든**.
    
    즉, 리플은 **채굴 없이 빠르고 에너지 효율적으로** 거래를 처리하려고 만들어짐
    

## 3.4 블록체인 확장

더 많은 트랜잭션이 블록체인에 기록됨에 따라 네트워크는 계속해서 저렴하고 쉬운 거래 방법을 제공해야 한다. 때문에, 이러한 확장성은 비트코인의 과제였다.

비트코인은 초당 3~7 개의 트랜잭션만 처리 가능함. 초당 6만 5000건의 거래가 가능한 비자 결제 네트워크와 비교해보자. 비자 네트워크가 확장될 때, 관리자들은 단지 자원의 할당을 조정할 수 있다. 비자는 서버에서 실행되는 데이터와 애플리케이션을 소유하고 **중앙 관리자를 통해 액세스**를 제어한다.

하지만, 비트코인은 탈중앙화로 네트워크가 구성된다. 많은 컴퓨터에서 실행되며 중앙 제거가 없음 → 때문에 비트코인 네트워크의 성장을 위해서, 원장에 기록되는 트랜잭션 수를 늘리던가 해야했다. **블록 사이즈를 높이거나** **각 블록에 들어가는 정보를 최소화하는 식으로 오랫동안 트랜잭션 처리 속도를 높이기 위해 노력**하고 있다.

오프체인(off-chain)을 통해 트랜잭션 데이터를 체인 외부로 빼내는 방법도 있다. 

### 3.4.1 세그윗

2015년까지 비트코인 인프라의 병목 현상이 분명해졌다. 비트코인 블록마다 들어갈 수 있는 것보다 더 많은 트랜잭션이 쌓이기 시작했다. 예를 들어, 초당 10건의 트랜잭션이 요청되었고 병목현상이 일어난다면, 7개의 트랜잭션이 처리되고 **나머지 3개는 멤풀에 남는다.** 

이는 아래와 같은 단점을 가짐

- 네트워크 상에서 거래 시간이 늦춰진다는 점
- 수수료가 비싸질 수 있다는 점 → 사용자들이 특정 한 블록에 자신의 트랜잭션을 기록하기 위해 경쟁해야 하기 때문에, 수수료 시장이 형성되므로

이 문제에 대한 해결책으로 제안된 것이 **세그윗(SegWit, Segregated Witness)**

<img width="579" alt="image" src="https://github.com/user-attachments/assets/5e4db7f0-4a67-4fb8-983f-d32e0fffe45a" />


- 서명 부분을 위트니스(witness)라는 데이터 영역으로 분리
    - 블록 크기 계산에서 제외돼 블록의 각 트랜잭션에 필요한 전체 공간을 효과적으로 줄임
    - 즉, 각 블록에 더 많은 트랜잭션이 저장됨
    - 또한, 트랜잭션 가변성 문제를 해결함
        - 트랜잭션 가변성: 블록으로 확인되기 전에 트랜잭션의 식별자를 바꿔치기 하는 공격

### 3.4.2 라이트닝

비트코인 메인 블록체인에 다 올리지 말고, **별도의 채널**에서 거래하자!

- 일부 비트코인 거래를 별도의 채널에 올려놓고, 메인 비트코인 블록체인에서 신뢰 없이 처리함
    - 트랜잭션이 줄어든 비트코인 네트워크는 지속적으로 유지하고 성장할 수 있음
- 거래 확인을 위해 채굴자와 블록을 요구하지 않고, 당사자 간의 서명을 사용해 암호화폐의 송수신 여부를 디지털로 검증함
    - 검증은 양방향 결제 채널에서 이루어짐
    - 사용자들은 네트워크에 채널을 만들고 자금 지원 금액으로 알려진 것을 블록체인에 게시해야 함

라이트닝의 문제는 두 당사자 간에 거래가 발생하려면 노드가 열려 있어야 한다는 것이다. 네트워크에서 부정행위가 만연하는 것에 관한 우려가 있고 이로 인해 부정 행위 가능성이 있는 거래를 모니터링하기 위해 감시용 노드를 포함해야 할 수도 있다.

## 3.5 이더리움 클래식 포크

이더리움은 2016년 6월 DAO라는 스마트 콘트랙트 실행 과정에서 5천만달러 해킹이 발생함 → 이 사건을 계기로 이더리움 클래식 포크가 발생

두 그룹으로 나뉘게 됨

- 그룹 1: DAO 해킹을 되돌리기 위해 이더리움 코드를 업데이트하자.
- 그룹 2: 트랜잭션을 되돌리면 하나의 단체가 네트워크를 통제할 수 있게 되고, 이는 탈중앙화 네트워크의 가치를 떨어뜨릴 것이기 때문에 소프트웨어를 현상 유지하자

이더리움 블록 #192만에서 새로운 코드로 업데이틀 진행(포크 발생) → 이더리움(ETH)

같은 소프트웨어를 계속 사용하며 마이닝을 진행 → 이더리움 클래식(ETC)

문제는 분리로 인한 리플레이 공격 가능성 발생 가능성이 존재했다.

- **하드포크 직후**, 두 블록체인 모두 **동일한 거래 데이터를 인정**하는 상태
- 누군가 ETH 블록체인에서 유효한 거래를 만들어도,
→ **ETC 블록체인에서도 그대로 실행될 수 있음**

아래와 같은 방법으로 해결

- 지갑 소유자들이 취한 대표적 대응 방법:
    - ETH 체인: 주소 A → 주소 **B**로 10 ETH 전송
    - ETC 체인: 주소 A → 주소 **C**로 10 ETC 전송
        
        → 각각 **다른 주소**로 분산 전송
        
- 이유:
    
    → 이후 누가 리플레이 공격을 시도해도, **잔액이 달라졌기 때문에 공격이 실패함**
    

<img width="608" alt="image" src="https://github.com/user-attachments/assets/d1e94e0e-5f08-46c5-a815-2ccbe20d2902" />


이건 임시 해결책이었음.

→ 이더리움 마이너들에게 발급된 업데이트 소프트웨어는 개발 및 출시 속도가 빠르게 진행돼 리플레이 보호 기능이 포함되지  않았음

→ 두 블록체인은 모두 5개월 간 리플레이 공격에 취약했다.

때문에, 이 기간동안의 이더리움 소유자들은 해결책을 직접 찾아야 했음
