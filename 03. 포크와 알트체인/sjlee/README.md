# 3장 - 포크와 알트체인

상태: 시작 전

암호화폐는 연구/개발 단계에 있으며 개발자들은 또 다른 비트코인을 만들기 위해 노력 중이다. 

확장성, 기능성, 투기성 등의 이유로 비트코인 코드를 분기해 비슷한 특성이 있는 새로운 암호화폐를 만들기 위한 제안이 있었다. 

## 3.1 비트코인 개선안

---

비트코인 코어는 오픈소스여서 개선을 위한 제안과 반영 과정을 거치면 끝날 것 같지만 실상은 말처럼 그리 쉽지 않다. 비트코인 프로토콜을 업데이트하려면 반드시 따라야 할 **거버넌스 프로세스**가 있다.

비트코인 개선 사항의 약자인 BIP(Bitcoin Improvement Proposals)는 소프트웨어 제품의 일반적인 개선 방식이다.. 소스를 개선하기 위한 지속적인 내부 프로세스가 있다.

비트코인 코어는 오픈소스다. 클라이언트 소프트웨어는 모든 사람에게 개방돼 있고 비트코인 커뮤니티가 소유하고 관리하도록 설계 됨. BIP는  비트코인 코어 코드를 지속적으로 관리하고 업데이트하는 커뮤니티의 과정이다. (지정된 위원회나 팀에 의해 결정되는 것이 아닌 전체 공동체에 의해 결정됨)

비트코인을 개선하기 위한 아이디어가 생기면 커뮤니티의 누구나 새로운 BIP를 제안할 수 있음

**BIP 생명주기**

- 커뮤니티의 누군가가 개선 아이디어를 제시하고 BIP 편집자에게 제안함
- 편집자가 승인하면 초안 상태에 넣기 위해 새로운 BIP를 만든다.
- 마이너들이 BIP에 관한 지지 신호를 보내면 최종 상태로 이동한다. 소프트웨어를 업그레이드해야 하기 때문에 새로운 BIP 채택에 동의해야 하는 대상은 마이너들이다.
- BIP가  최종 상태에 있다면 나머지 커뮤니티는 새로운 소프트웨어로 업그레이드 해야한다.

<img width="507" alt="image" src="https://github.com/user-attachments/assets/9a651ac4-f0db-4cab-b91b-6b1003d6a306" />


## 3.2 포크에 관한 이해

---

비트코인 커뮤니티가 네트워크의 공동 이익을 위해 함께 모이기 시작하고 점점 커지면서 많은 프로그래머들이 **소프트웨어 포크를 통해 개량한 비트코인**을 만들 수 있게 됐다. 그 결과로 **알트코인**으로 알고 있는 대체 코인들이 탄생했다. 알트코인 중 일부는 비트코인과 너무 달라 알트체인이라고 한다. 포크는 실제로 암호화폐 세계에서 다른 의미가 있는데, 다음과 같은 용어를 사용한다.

- 소프트웨어 포크
    
    기술 시스템과 오픈소스 소프트웨어의 일반적인 용어다. (포크 뜨는 행위)
    
- 소프트포크
    
    블록체인 기술과 관련해 네트워크를 변경하지만 모든 채굴자가 참여할 필요는 없는 채굴 소프트웨어의 업그레이드다.  소프트포크는 이전 소프트웨어와 호환되며 보통 트랜잭션 기능을 업그레이드하기 위해 수행된다.
    
- 하드포크
    
    블록체인 기술과 관련해 하드포크는 채굴 소프트웨어를 업그레이드해 네트워크를 바꾸는 것으로 모든 채굴자가 참여해야 한다. 주요 보안 또는 기능 변경을 구현하며 업그레이드는 이전 소프트웨어와 호환되지 않는다.
    
- 논쟁의 여지가 있는 하드포크
    
    블록체인 기술에서 논쟁의 여지가 있는 하드포크는 마이닝 소프트웨어에 대한 하위 호환성이 없는 업그레이드로서, 포크를 모두가 동의하지 않을 경우 네트워크에 변화를 준다. 일부 마이너들이 포크에 동의하지 않아 업그레이드하지 못하면, 사실상 블록체인이 둘로 갈라진다. → 과거 기록은 각 지점에서 동일하지만, 논란이 된 하드포크 시점부터 두 체인은 서로 다른 트랜잭션을 기록하고 소프트웨어도 호환되지 않는다.
    

### 3.2.1 논쟁을 불러온 하드포크

논쟁의 여지가 있는 하드포크가 발생하면 암호화폐의 메인 블록체인이 두 개로 분리된다. 아래 그림과 같이 2017년에 비트코인에서 분리된 체인 비트코인 캐시가 대표적이다.

<img width="353" alt="image" src="https://github.com/user-attachments/assets/5a50dd5c-258e-4a3f-9dac-9e5bb2c3ae46" />


각 블록체인은 **포크 이전**의 메인 블록체인의 역사를 계승한다. 기록은 이전 거래, 각 주소의 잔액, 각 블록의 해시 등을 포함한다. 포크가 발생하는 순간까지 두 블록체인은 동일한 기록을 가지고 있다. **포크 이후**에는 각 블록체인이 자체적인 새로운 블록과 새로운 트랜잭션 기록을 만들고, 블록은 서로 다른 마이너가 채굴할 수 있다.

위 그림에서 주소 A는 메인 비트코인 블록체인의 포크 앞에 100 BTC 잔액이 있다. 포크 이후 두 개의 새로운 체인이 메인 체인으로 분리돼 비트코인(BTC)과 비트코인캐시(BCH)로 나뉘었다. 주소 A는 두 신규 블록체인에 모두 잔액이 100으로 유지돼 비트코인 블록체인에 100BTC, 비트코인캐시에 100 BCH가 있다.

이전의 비트코인 체인(BTC)은 포크 코드가 제시되기 이전과 같이 여전히 존재한다. 비트코인캐시 노드가 **1MB 이상의 블록을 수용하기 시작하면 비트코인캐시 체인은 스스로 비트코인에서 벗어나 새로운 체인을 만든다**.

### 3.2.2 마이너

**마이너는 네트워크 실행을 위해 해시파워를 기여하는 사람들**이다. 이어 논쟁의 여지가 있는 하드포크가 발생하면 마이너는 **프리포크된 블록체인이 사용하는 소프트웨어를 그대로 유지**하거나 **포크된 블록체인 소프트웨어로 변경**한다.

<img width="439" alt="image" src="https://github.com/user-attachments/assets/5eeb3253-b923-41bd-ad43-4453248b8290" />

위 그림을 보자.

비트코인캐시 포크의 경우 비트코인캐시를 지원하려는 채굴자들이 #478560블록에서 소프트웨어를 비트코인 ABC v0.14.6으로 바꾸고, 새로운 네트워크에 해시파워를 기여하기 시작했다. 비트코인을 지원하려는 마이너들은 같은 비트코인 코어 클라이언트 0.14.2를 계속 사용했다.

> 해시파워는 작업 증명 기반 블록체인의 생존에 중요하다. 다중 당사자가 네트워크에 더 많은 해시파워를 기여할수록, 단일 노드가 네트워크를 통제하는 데 더 많은 비용이 들기 때문에, 네트워크가 더 탈중앙화된다. 블록체인 네트워크가 탈중앙화 될 수록 네트워크 보안에 관한 신뢰도가 높아진다.
> 

논란이 되는 포크가 발생하면 커뮤니티는 2,016개의 블록이 생성되고 나서 **해시레이트가 가장 높은 블록체인을 승리한 것을 간주한다**. 그리고, 블록체인이 포크 이름을 그대로 유지하게 된다. 프리포크 이름들은 거래소에서 블록체인에 붙여진 이름들이고 암호화폐 가격에도 큰 영향을 미치기 때문에 매우 중요하다.

오늘날, 비트코인은 커뮤니티는 비트코인, 비트코인캐시, 비트코인SV까지 세 개의 블록체인으로 나뉜다. 아래 그림처럼 비트코인의 해시레이트가 단연코 가장 높다.

<img width="714" alt="image" src="https://github.com/user-attachments/assets/6e8f8fc4-3317-4726-a041-235d7fd757d6" />

### 3.3.3 리플레이 공격

하드포크가 발생하면 두 개의 새로운 블록체인이 모두 리플레이 공격에 취약해질 수 있다. **리플레이 공격은 공격자가 한 블록체인에서 합법적인 거래의 데이터를 가져다가 두 번째 블록체인에서 해당 거래를 복제하거나 미러링할 때 발생**한다.

두 블록체인이 모두 트랜잭션 서명을 생성하는 프로세스가 정확히 같을 경우, 리플레이 공격에 취약하다. 아래 그림은 비트코인과비트코인캐시 블록체인이 리플레이 공격에 취약할 때 발생할 수 있는 상황을 보여준다.

포크 이후에 리플레이 공격이 일어나는 예시다.

<img width="530" alt="image" src="https://github.com/user-attachments/assets/478caf1b-78a8-44b2-9581-1310c063d33a" />

1. 주소 A는 주소 B로 60 BTC를 보내라는 거래 지시를 비트코인 네트워크에 브로드캐스트한다.
2. **브로드캐스트에는 트랜잭션 데이터(입력 및 출력)와 트랜잭션 서명이 포함**된다.
트랜잭션 서명은 주소 A가 개인키를 사용해 생성할 수 있으며 네트워크에 (비트코인 네트워크에서) 트랜잭션을 승인했다고 증명한다.
3. 주소 A가 거래 데이터와 거래 서명을 공개적으로 브로드캐스트했기 때문에 누구나 같은 정보를 비트코인캐시 네트워크로 브로드캐스트할 수 있다. 그리고, 두 체인이 유사하기 때문에 네트워크가 이를 처리할 것이다.

다행히 비트코인캐시 포크가 발생했을 때, 새로운 소프트웨어 비트코인캐시 마이너는 어느 블록체인에서든 리플레이 공격이 일어나지 않도록 변경사항을 포함하고 있었다.

비트코인캐시 소프트웨어는 네트워크를 통해 전송되는 트랜잭션 데이터의 구 조에 `SIHASH_FORKID`라는 새로운 필드를 추가했다. 새 필드가 유효하려면 비트코인캐 시 트랜잭션에 있어야 한다. **트랜잭션 서명이 생성될 때 암호화 알고리즘의 입력 중 하나가 트랜잭션 데이터다.**
즉, 비트코인 코어 블록체인에 생성되는 서명은 비트코인캐시 블록체인과 다르고, 다른 체인에서는 유효하지 않다.(트랜잭션 데이터가 두 블록체인에 다르게 구조화돼 있기 때문에)
