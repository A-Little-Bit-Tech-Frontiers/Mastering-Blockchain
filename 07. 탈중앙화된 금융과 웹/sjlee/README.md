# 1. 신탁 재분배

암호화폐를 사용하는 결제 계층은 블록체인으로 중개자 없이 거래할 수 있다. 시간이 지남에 따라 회사가 아닌 개인이 데이터를 소유할 수 있게 됨

## 1.1 해킹의 정체성과 위험성

### 사용자 데이터 소유권의 중요성

- 사용자가 자신의 데이터를 소유하는 것이 왜 중요한지 묻고 있음.
- 대기업들이 데이터를 반복적으로 침해(해킹 등)하면서 사용자는 자신의 정보를 보호할 수 없게 됨.

### 블록체인과 데이터 보호

- **블록체인 기술**은 다양한 산업에 빠르게 확장되고 있음.
- 사용자 주도의 데이터 제어 기술인 스캐폴딩(Scaffolding)이 주목받고 있음.
- 개인 고유 식별자를 생성하고 **공개키-개인키 쌍**을 이용해 인증하는 방식.

### 기술적 과제: 보안과 편의성의 균형

- 개인키 관리 및 거래 확인 절차는 복잡하고 사용자에게 어렵거나 번거로움.
- 초기 플랫폼들은 이 균형 문제 해결을 위해 노력 중.

## 1.2 지갑(Wallets)

### 개념

- **디파이(DeFi)** 서비스를 사용하기 위해서는 지갑 사용에 익숙해져야 함.
- 지갑은 사용자의 **개인키와 자산을 저장**하는 도구로, 다양한 형태가 존재.

### 주요 유형

- **소프트웨어 지갑**: 예) 메타마스크(MetaMask) – 브라우저 확장 프로그램으로 크롬, 파이어폭스 등에서 작동.
- **하드웨어 지갑**: 예) 레저(Ledger) – USB 형태의 물리적 저장 장치.
- **보관형 서비스**: 예) 코인베이스(Coinbase) – 개인키를 대신 관리해줌.

## 1.3 개인키

### 중요성

- 메타마스크나 레저 지갑은 **사용자가 직접 개인키를 알고 안전하게 저장**해야 함.
- 패스워드나 니모닉(nemonic)을 잃어버리면 **자산 영구 손실** 가능.
- 따라서, ID를 유지하면서 개인키를 보호할 수 있는 **새로운 서비스**가 필요함.

### 대응 방안

- 코인베이스 등 중앙형 서비스들은 이미 **개인키 백업 및 복구 절차** 도입 중.
- 예: 키베이스(Keybase), 블록스택(Blockstack) – 개인키 관리 간소화.

## 1.4 네이밍 서비스(Naming Service)

### 개념

- 공개키는 이메일 주소, 사용자 이름 또는 기타 식별자보다 훨씬 사용하기 어렵지만 탈중앙화 서비스에서는 매우 중요함.
- 공개키는 일반인이 사용하기 어려운 문자열임 → 이를 읽기 쉽고 기억하기 쉬운 이름으로 대체.
- 예: `username.eth` 같은 **이더리움 네임 서비스(ENS)** 형식.

### 단점

- 블록체인은 **모든 거래가 공개**되므로, 이름 기반 주소는 **프라이버시 노출** 위험이 있음.
→ 개인의 거래 이력이 추적될 수 있음.

### 예시

- 그림에서 QR 코드로 **공개키와 개인키의 형식**을 비교 설명:
    
    <img width="469" alt="image" src="https://github.com/user-attachments/assets/4718b832-ec8e-4b13-a9c7-5892e42b4ec9" />

    
    - 왼쪽: 비트코인 주소(공개키)
    - 오른쪽: 지갑 백업용 개인키

# 2. 탈중앙화 금융

중개인이 없는 금융 서비스 생태계가 빠르게 성장하고 있음. 현재 많은 플랫폼이 탈중앙화 금융을 제공하기 위해 노력하고 있다.

디파이 서비스는 스마트 콘트랙트, 암호화폐, 블록체인을 활용해 은행권이 전통적으로 제공해온 일부 서비스 대체 가능

<img width="488" alt="image" src="https://github.com/user-attachments/assets/de8a5cc3-3062-43a5-ab83-707d7dd46244" />


디파이는 여러 구성요소로 이뤄짐. 그 중 상당수가 이더리움과 ERC-20 자산에 의존한다. 

**디파이의 유동성 풀**

- ERC-20의 **호환성과 유동성 풀** 덕분에 디파이 생태계에서 자유롭게 자산을 이동·교환할 수 있음.
- 시장 상황에 따라 유동성을 **유연하게 확장하거나 축소**할 수 있음.

## 2.1 중요한 정의

스마트 컨트랙트는 디파이 모델의 필수다. 많은 암호화폐는 유통되는 자산의 고정 공급이 존재하기 때문에 가치가 있다. 단, 많은 디파이 토큰은 시스템의 디자인에 따라 인플레이션 또는 디플레이션을 발생시키는 탄력적인 공급장치를 갖고 있다.

### 2.1.1 민팅

- 암호화폐 공급을 늘리기 위해, 새로운 암호화폐 자산을 생성하는 과정
- 거버넌스 시스템을 통패 인플레이션을 제한하기 위해 민팅은 적절하게 통제돼야 한다.
    
    무분별한 민팅 → 암호화폐 가치 하락 → 구매력도 줄어들며, 재산을 저장하는 수단으로서 신뢰성이 낮아지기 때문.
    
- 그래서, 민팅은 보통 컴퓨터 알고리즘에 따라 고정되거나, 혹은 시스템 내부에서 일정 권한을 가진 사람들이 통제함

### 2.1.2 소각

- 암호화폐 공급을 줄이기 위해, 유통 중인 코인을 영구적으로 제거하는 과정
- 공급을 줄여 가격 상승을 유도할 수 있지만, 디플레이션 위험도 존재
    - 돈이 너무 가치 있어지면 오히려 사람들이 쓰는걸 꺼리게 됨 → 시장이 위축됨

### 2.1.3 랩드토큰

비트코인 등 이더리움 외부 자산을 ERC-20 토큰처럼 활용할 수 있게 만드는 것이다. **원래 자산은 담보**로써 온체인에서 보유할 수 있게된다.

- 즉, 서로 다른 블록체인(비트코인, 솔라나 등)의 자산을 **이더리움에서 쓸 수 있도록** 만들어주는 게 랩드토큰이라는 해결책.
- 진짜 자산(BTC 등)은 **어딘가에 맡겨진 상태로 보관**되고, 대신 사용 가능한 **포장된 복제품**이 생김.
- 스마트 콘트랙트가 자동으로 민팅과 소각을 관리해 주기 때문에, 관리자가 수동으로 처리하지 않아도 됨.
    - 사용자가 **진짜 BTC**를 **보관소에 예치**함 (→ 민팅 조건 충족)
    - 스마트 콘트랙트가 그걸 확인하고, **ERC-20 형식의 토큰(예: WBTC)을 발행**함
    - 이더리움 생태계 안에서 이 **포장된 BTC(WBTC)**를 자유롭게 거래할 수 있게 됨
    - 반대로 WBTC를 소각하면 → 진짜 BTC를 돌려줌

### 2.1.4 DAO

탈중앙화 자치 단체(DAO)는 주로 이더리움 스마트 컨트랙트를 통해 조직된 프로젝트다. 중앙 당국의 통제를 받지 않는 DAO는 거버넌스를 제공할 토큰 홀더를 보유하고 있다.

- 블록체인 기반 스마트 콘트랙트를 활용하기 때문에, 트랜잭션에 대한 투명한 기록과 DAO를 조정하는 규칙이 존재

### 2.1.5 오라클

블록체인은 데이터베이스와 같은 데이터 소스와의 인터페이스가 없기 때문에, 외부에 정보를 제공하기 위한 무언가가 필요하다.
즉, 블록체인은 외부 세계의 정보를 직접 알 수 없다. → 외부 데이터를 블록체인 안으로 안전하게 넣어줄 녀석이 필요

중앙집중식 데이터베이스에 기록된 실제 발행 이벤트나 데이터를 블록체인으로 가져오는 역할이 필요한데, 이 목적을 달성하는 녀석이 오라클

<img width="308" alt="image" src="https://github.com/user-attachments/assets/ef090742-3016-4256-abe1-2fa93e1ff463" />


위와 같이 오프체인 데이터를 온체인으로 가져온다. 

- 오라클은 스마트 콘트랙트가 코드 실행에 사용하는 데이터를 제공함 → 블록체인 생태계에서 중요한 역할
- 오라클의 피드나 조작이 잘못되면 스마트 컨트랙트가 실행 → 회복할 수 없는 자금 손실 발생
- 오라클 시스템에 대한 신뢰가 중요 → 오라클이 조작되고 있다면 해커들이 악용할 수 있는 취약점이 되기도 함

## 2.2 스테이블코인

미국 달러화 및 기타 피앗 통화에 부합되는 블록체인 기반 자산이다. 스테이블코인은 은행 중개인이 필요없는 서비스를 뒷받침 한다.

스테이블 코인은 규제 위험이 있고 프로젝트 간에는 다양한 수준의 가버넌스 및 중앙집중화가 있지만, 여러 흥미로운 실험이 있음.

### 2.2.1 DAI

디파이에서 사용되는 대표적인 스테이블코인이다.

**DAI란?**

- DAI(다이코인)는 **MakerDAO**라는 디파이 프로젝트에서 발행한 **스테이블코인**.
- 일반적인 암호화폐는 가격이 매우 불안정하지만, DAI는 **가치가 달러에 고정된 암호화폐**로 설계됨. → 안정적인 자산
- 2018년 첫 출시 당시에는 **ETH만을 담보로 지원**했지만,
이후 **BAT, 기타 이더리움 기반 토큰들까지** 지원하는 **다중 담보형 토큰(Multi-Collateral DAI)**으로 진화함.

**DAI 발행 및 상환 메커니즘**

스테이블코인인 DAI를 뒷받침하는 **암호화폐는 본질적으로 변동성이 크다**. 그렇다면 메이커는 변덕스러운 시장으로부터 안정적인 자산을 어떻게 창출할 수 있을까?

1. DAI 생성 과정
    - 사용자는 이더리움(ETH) 같은 암호화폐를 **Maker 스마트컨트랙트에 예치**함.
    - 시스템은 **담보가치의 150% 수준까지 DAI를 발행**할 수 있도록 허용.
    e.g.) 150달러어치 ETH 예치 → 100달러어치 DAI 발행 가능
2. 가격 하락 시 조치
    - 담보로 맡긴 ETH 가격이 **150% 아래로 떨어지면** 시스템은 **포지션 청산 절차를 시작**.
    - 사용자가 담보 요구사항을 충족하기 위해 ETH 또는 DAI를 입금하지 않으면 포지션이 종료된다.
    - e.g.) 75달러로 하락하면 자동 청산 발생
3. DAI 상환 시
    - DAI를 반납하면 사용자는 담보 자산을 돌려받을 수 있음.
    - 이때 **3% 정도의 안정성 수수료** 발생 (변동 가능)

결국 DAI가 필요한 이유는?

- 비트코인이나 이더리움은 너무 변동성이 크고, 현실에서 쓰기에는 적합하지 않음
- 그런데 DAI는 블록체인 기반인데도 **"달러처럼 쓸 수 있게 설계된 돈"**
    
    → 결제, 송금, 대출, 예치 등에 사용하기 딱 좋은 도구
    
- 위 내용 상으로 보면, 스테이블코인이 왜? 누구에게? 안정적인것일까?
    - **DAI를 발행한 사람 (= 담보 제공자)**
        - 이 사람은 ETH를 맡기고, 그걸 담보로 DAI를 발행한 사람
        - **예)** 농부가 땅을 담보로 대출을 받는 것과 비슷
    - **DAI를 그냥 사용하는 사람**
        - 보통 말하는 스테이블코인의 ‘안정성’ 대상은 여기임
        - 이 사람은 그냥 **DAI를 받아서 결제하거나 예치하거나 투자**하는 사람
        - 이 사람은 **DAI의 가치가 1달러 근처에서 유지**되기만 하면 됨
        - 담보가 뭘로 되어 있는지, ETH 가격이 오르든 말든 **신경 쓸 필요 없음**
        - 마치 스테이블코인을 디지털 달러처럼 사용하는 것.!

### 2.2.2 USDC

USD Coin으로, ERC-20 기반 스테이블코인이다.

코인베이스와 서클이 공동으로 개발했으며, **Centre(센트레) 컨소시엄**이 관리함

**특징**

- **미국 달러와 1:1 연동** (1 USDC = 1 USD)
- **Grant Thornton LLP**라는 감사 회사가 매달 **준비금(달러 보유액)**을 증명
- 발행 및 상환 시 **KYC 절차(개인 인증)** 필요

### 2.2.3 TrueUSD

**TrustToken**이라는 미국 회사가 운영하며, USDC처럼 **ERC-20 기반** 스테이블코인이다.

TrustToken은 TUSD 외에도 **여러 국가 화폐 기반 스테이블코인을 보유
→** 예: 캐나다 달러, 영국 파운드, 호주 달러, 홍콩 달러 등

**특징**

- **Cohen & Cohen**이라는 감사 법인이 준비금 확인
- **은행 보유 준비금이 실제 존재**하는지 매달 증명
- USDC처럼 **취득 또는 상환 시 KYC 제출** 요구

### 2.2.4 KYC와 익명성

| 항목 | **DAI** | **USDC / TUSD** |
| --- | --- | --- |
| **KYC 필요 여부** | 필요 없음 | 필요함 |
| **발행 구조** | 탈중앙, DAO 기반 | 중앙 발행사(Circle, TrustToken) 기반 |
| **주요 담보** | 암호화폐 (ETH, BAT 등) | 실물 달러 (은행 예치금) |
| **지원 대상** | 암호화폐 네이티브 환경 | 전통 금융 (피아트 중심 거래) |

<img width="489" alt="image" src="https://github.com/user-attachments/assets/a5d073d7-617e-4c6d-8691-1e8874839559" />


- KYC는 발행단계에만 걸림
- 이후 블록체인 상에서는 KYC 여부와 관계없이 자유롭게 전송/사용이 가능
- DAI는 진입장벽이 낮고 익명성이 높은 디지털 스테이블코인, USDC/TUSD는 규제를 따르는 금융기관 친화형 스테이블코인

# 3. 디파이 서비스

- **스테이블코인의 유동성 증가**와 함께 디파이(DeFi) 생태계가 성장
- 디파이 서비스는 사용 용도에 따라 다양하게 진화 중 (아래와 같은 용도들로 시장에서 사용되고 있음)

## 3.1 대출

피앗을 빌려 암호화폐를 지키려는 사용자를 위한 시장이다. 암호화폐 보유자들은 투기적 이유로 혹은 암호화폐의 장기적 가치를 믿기 때문에 암호화폐를 팔지 않는다. 또한 자산을 포기하지 않으려 하고, 특혜를 위해 비용을 지불할 것이다.

이때, 가장 큰 분권형 대출 플랫폼 중 하나인 컴파운드와 같은 서비스를 사용함

- 사용자가 암호화폐를 담보로 대출할 수 있게 함
- 담보로 발행되는 DAI는 가격이 고정된 디지털 달러처럼 사용 가능
- 즉, DAI는 달러에 고정되어 있어서 시장에서 피앗에 판매되거나 다른 암호화폐에 재투자 하는 등으로 사용 가능함

## 3.2 예치

### 목적

사용자가 암호화폐(스테이블코인)를 스마트 컨트랙트로 잠그는 방식이다.

쉽게 말해, 사용자는 스테이블코인(예: DAI)을 **스마트 컨트랙트에 예치**하고 이자를 얻음

### 예시

MakerDAO의 **DAI 예치 보상 시스템 (DSR - DAI Savings Rate)**

- DSR 컨트랙트는 DAI 예치자에게 **보상 이자**를 지급
- 이자는 DAI를 빌리는 사용자들이 내는 **안정성 수수료**에서 충당됨
- 이율은 MKR 토큰 보유자들의 **거버넌스 투표로 결정**
- **출금 시 위약금 없음**, **컴파운드도 예치 프로그램 운영**

→ 보상의 기준은 스마트 컨트랙트 구현 방식에 따라 달라지는 것인가?

# 4. 탈중앙화 거래소

암호화폐 거래소가 대부분 중앙집중화돼 있으며, 지갑을 호스팅하고 모든 거래에서 수수료를 챙긴다.

스마트 컨트랙트를 통해 개발자는 DEX라고도 알려진 탈중앙화 거래소를 구축할 수 있음. 탈중앙화 거래소는 트레이더가 자신의 개인키를 쥐고 암호화폐를 교환할 수 있도록 한다.

## 4.1 탈중앙화 거래소(DEX)란?

> 스마트 컨트랙트를 기반으로 사용자가 직접 자산을 교환하는 구조
> 
> 
> 대표 예: [**Uniswap**]
> 

### 특징

- *개인 지갑(예: 메타마스크)**으로 직접 거래 가능 (개인키 보유 필수)
- 중앙 운영자 없이 **자동화된 프로토콜**에 의해 운영됨
- **0.3% 거래 수수료**는 유동성 공급자에게 분배됨
- 모든 거래는 **블록체인 위에 기록**되며 공개적으로 감시 가능

## 4.2 중앙집중화 거래소(CEX)란?

> 기업 또는 중앙 기관이 통제하는 전통형 암호화폐 거래소
> 

### 특징

- 웹사이트 로그인, 계정 생성, KYC 필요
- **거래소가 보유한 데이터베이스**와 서버 인프라에서 모든 처리가 발생
- 사용자 자산은 **거래소 지갑에 예치**됨 (→ 사용자 개인키 없음)
- 더 빠르지만, **보안 위협**, **해킹**, **출금 제한** 등의 리스크 있음

## 4.3 거래소별 기반 인프라

중앙집중화 거래소에서 모든 인프라는 단일 엔티티에 의해 제어되며 웹사이트를 통해 사용자에게 전달된다. 이와 반대로 유니스왑의 모든 부분은 지역사회에 의해 운영된다.

<img width="605" alt="image" src="https://github.com/user-attachments/assets/185507ae-ddc7-4480-b8f6-ee5c6e455048" />


### 4.3.1 중앙집중화 거래소와 탈중앙화 거래소의 프론트엔드 차이점

<img width="714" alt="image" src="https://github.com/user-attachments/assets/28d6eb64-0632-4daf-bde1-67dfab84f864" />


### 4.3.2 중앙집중화 거래소와 탈중앙화 거래소의 백엔드 차이점

<img width="717" alt="image" src="https://github.com/user-attachments/assets/12e9c1a6-5abb-4862-a4d8-a2eeedd3e097" />


## 4.4 ERC-20 토큰의 탈중앙화 거래소(유니스왑) 상장 방식

중앙화 거래소는 발행자가 거래소 측과 비즈니스 협상을 하며 토큰 상장을 해야 한다. 상장 수수료 지급, 법률 문서 제출 등과 같이 복잡하고 느리다.

반면에, 탈중앙화 거래소는 누구나 자유롭게 상장할 수 있다. 스마트 컨트랙트 내 `createExchange()` 메서드 호출만으로 등록이 가능하다.

<img width="544" alt="image" src="https://github.com/user-attachments/assets/0561a86e-d672-46c3-a50e-8c8d7c56cb1a" />


인자로 ERC-20 토큰 스마트 컨트랙트 주소를 전달해야 한다. 

## 4.5 커스터디 및 거래처 리스크

### 중앙화 거래소의 위험

- 거래소가 **사용자의 자산을 보관**
- 해킹/파산/폐쇄 시 **자산 손실 위험**
- 사용자는 **자산 흐름을 통제할 수 없음**

### 탈중앙화 거래소의 장점

- 자산은 **사용자의 지갑에 저장** (메타마스크 등)
- 스마트 컨트랙트는 **모든 함수와 흐름이 코드로 공개**
- 자산 입출금, 거래, 보관 흐름이 모두 **사용자 개인 서명**에 의해 이루어짐

## 4.6 본인인증

중앙화 거래소는 자금세탁 방지 등에 대응하기 위해 KYC를 위해 신원 정보를 제출해야 한다. 

이와 달리 탈중앙화 거래소는 누구나 허가 없이 거래소를 사용할 수 있다. 하지만, 암호화폐 거래만 허용하고 USD나 EUR와 같은 피아트 통화는 지원하지 않는다는 단점 또한 수반한다.

피아트 통화를 지원하지 않는 이유: 모든 피아트 통화가 은행이나 금융 기관과 같은 중앙 기관을 사용하는 전통적인 은행 시스템에 묶여 있기 때문

## 4.7 확장성

### 중앙 집중화 거래소

- 초당 수백만 건의 작업을 수행할 수 있도록 인프라 운영이 가능

### 탈중앙화 거래소

- 퍼블릭 블록체인으로 동작하기 때문에 **트랜잭션 처리량은 블록체인의 최대 트랜잭션 속도에 의해 제한**된다.
- 2020년 기준 최대 거래량은 초당 20건 미만이라고 함..

# 5. 플래시론(Flash Loan)

---

플래시론은 담보 없이도 아주 짧은 시간 동안(단일 트랜잭션 안에서) 대출이 가능한 디파이 대출 방식이다.
일반 대출처럼 담보 제공, 신용 평가가 필요 없고, 대출과 상환이 **동일 트랜잭션 내에서 자동으로 처리**되기 때문에 **채무불이행(디폴트)** 리스크가 없다.

## 5.1 플래시론 동작 방식

<img width="469" alt="image" src="https://github.com/user-attachments/assets/a812ea35-a396-46c1-9554-8729636f1f7f" />


### 1. 대출 실행 및 사용 (1~2단계)

- 스마트 컨트랙트가 대출 요청을 하면, 대출 플랫폼(예: Aave)에서 자금을 빌려줍니다.
- 그 자금으로 다음과 같은 작업을 수행할 수 있습니다:
    - 탈중앙화 거래소에서 차익 거래(Arbitrage)
    - 포지션 청산
    - 담보 교체
    - 담보 기반 대출 리파이낸싱 등

### 2. 자금 상환 (3단계)

- 같은 트랜잭션 내에서 **수수료 포함 전체 금액을 반환**하지 않으면, **트랜잭션 전체가 롤백**되어 무효 처리됩니다.
- 따라서 플래시론은 **대출 실패 = 아무 일도 없던 것처럼 되돌림** 구조로 되어 있음.
