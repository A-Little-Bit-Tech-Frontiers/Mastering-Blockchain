# 7장 탈중앙화된 금융과 웹

**탈중앙화 금융 및 탈중앙화 애플리케이션 영역이 보여주는 가능성**

---

### 신탁 재분배

암호화폐를 사용하면 블록체인으로 **중개자 없이(신탁 불필요)** 거래할 수 있다. 따라서 시간이 지남에 따라 회사가 아닌 개인이 데이터를 소유할 수 있게 된다.

**해킹의 정체성과 위험성**

대기업은 반복적인 해킹, 침입 등 다른 방법으로 피해를 입어 데이터 관리자의 역할을 하지 못하고 있다. 이러한 산업들에 블록체인을 도입하려는 실험은 이미 시작됐고, 사용자가 데이터를 보다 효과적으로 제어할 수 있도록 기술적 스캐폴딩이 구축 중이다.

블록체인 기술로 탄생한 궁극의 아이디어는 개인이 고유한 키를 생성하고 **공개키-개인키 쌍** 을 사용하는 방법이다. **개인정보는 공개키를 사용해 접근하고, 정체성은 개인키로 인증한다.**

문제는 기술의 복잡성과 사용 편의성의 균형을 맞추는 것이다. 초기 플랫폼은 이러한 균형 문제를 해결하기 위해 노력하고 있다.

- 지갑
    - Defi 서비스를 이용하기 위해 사용자는 지갑 사용에 익숙해져야 한다.
- 개인키
    - 코인베이스 등 다양한 플랫폼은 개인키를 보호하면서 ID 를 유지할 수 있는 방법을 제공한다.
- 네이밍 서비스
    - QR 코드, 이더리움 네이밍 서비스는 공개키를 쉽게 읽고 쓰기 가능한 형태로 제공한다.

### 탈중앙화 금융

Defi 서비스는 은행권의 전통적인 일부 서비스를 대체할 수 있다. Defi 의 여러 구성요소 중 상당수가 이더리움과 ERC-20 자산에 의존하는데, ERC-20 의 유연성은 시장 상황에 따라 유동성의 풀을 확장하거나 줄일 수 있기 때문이다.

<p align="center">
    <img width="600" alt="Image" src="https://github.com/user-attachments/assets/6a6d79bf-ee59-4220-b1cf-2108d512e189" />
</p>

- **민팅 (Minting)**
    - 암호화폐 공급을 늘리기 위해 사용되며 새 자산을 만드는 기능을 포함한다. 이는 보상을 받으려는 스테이커(초기 투자자)나 인센티브 용으로 자산을 만드는 사용자(소액 투자자)를 위해 새 블록을 생성해 수행된다.
    - 거버넌스 시스템을 통해 인플레이션을 제한하기 위해, 민팅은 적절하게 통제되어야 한다.
- 소각
    - 시스템 관계자가 유통량을 줄이고 공급을 줄임으로써 가상화폐 가격을 상승시킨다.
- 랩드토큰
    - 스마트 컨트랙트로 ERC-20 과 다양한 암호화폐를 거래하려는 사용자들로 인해 랩드토큰이 해결책이 되었다.
- DAO (탈중앙화 자치 단체)
    - 주로 이더리움 스마트 콘트랙트를 통해 조직되었다. 중앙 정부의 규제를 받지 않으며, 거버넌스를 제공할 토큰 홀더를 보유하고 있다.
- 오라클
    - 블록체인은 데이터 소스 인터페이스가 없기 때문에 외부에 정보를 제공하기 위해 필요한 레이어이다.

**스테이블코인**

미국 달러화 및 기타 Fiat 통화와의 가치에 부합하는 블록체인 기반 자산이다. 이는 은행 중개인이 필요 없는 서비스를 뒷받침한다.

**스테이블코인 실험**

---

**DAI (다이코인)**

**메이커 프로젝트** 에서 탄생했으며 주요 스테이블 암호화폐이다. 원래 ETH 만 지원했으나, 이후 BAT 및 기타 여러 암호화폐를 지원하는 다중 담보 토큰으로 업그레이드 되었다.

**메이커 시스템 정리**

1. **ETH를 담보로 맡기면 DAI를 빌릴 수 있음**

- 사용자는 **ETH(이더리움)** 를 메이커의 **'볼트(Vault)'라는 스마트 계약** 에 예치한다.
- 이렇게 하면, **DAI라는 스테이블코인(달러와 1:1 가치를 지닌 코인)** 을 빌릴 수 있다.
- 단, **150%의 담보율** 을 유지해야 한다.
    - 예: 150달러어치의 ETH를 맡기면, **최대 100달러어치의 DAI** 만 인출 가능

---

2. **담보 가치가 떨어지면 청산될 수 있음**

- ETH 가격이 하락하면, **담보율이 150% 아래로 떨어질 수 있다.**
- 담보율이 기준보다 낮아지면, **시스템이 자동으로 포지션을 청산**
    - 예: 150달러에 맡겼는데 ETH가 75달러가 되면 청산
- 하지만 사용자가 **DAI를 적게 인출** 하거나, **담보를 추가** 하면 청산을 막을 수 있다.

---

3. **DAI를 돌려주고 담보를 찾을 때 수수료가 있음**

- 사용자가 DAI를 다시 시스템에 **반환하면 담보 ETH를 되찾을 수 있다.**
- 이때 **안정성 수수료(stability fee)** 가 부과된다.
    - 현재 수수료는 **3%** 이며, 나중에 바뀔 수도 있다.
- 이 수수료는 **MKR 토큰을 사서 소각하는 데** 사용된다.

---

4. **MKR 토큰의 역할**

- 메이커는 **DAO(탈중앙화 자율 조직)** 이다.
- **MKR 토큰 보유자**는 다음과 같은 것들을 **투표로 결정한다**:
    - 담보 기준
    - 안정성 수수료율
    - 시스템 비상 정지(가격 폭락 대비)
- MKR은 시스템 내에서 중요한 역할을 하는 **거버넌스 토큰이다**.

---

5. **개인 정보 없이 사용 가능**

- 메이커는 **스마트 콘트랙트 기반** 이라, 사용자가 **개인 정보를 제출하지 않아도 된다.**
- 필요한 건 오직 **개인 키와 약간의 ETH** 뿐이다.

---

**USDC (USD Coin)**

ERC-20 기반 스테이블코인이며 코인베이스와 서클(Circle) 이 만들었다.

사용자가 KYC 수표에 대해 개인정보를 제출하도록 요구하는 시스템으로 운영된다.

---

**TrueUSD (TUSD)**

ERC-20 달러 기반 스테이블코인이며 트러스트토큰 이라는 미국 기반 회사의 지원을 받는다.

사용자가 TUSD 를 취득하거나 사용하기 위해 개인 KYC 정보를 제출하도록 요구하는 시스템으로 운영된다.

**사용자 본인인증(KYC)와 익명성**

<p align="center">
    <img width="600" alt="Image" src="https://github.com/user-attachments/assets/571e579e-9fac-488c-8f7b-9e82b104386d" />
</p>

### 디파이 서비스

---

**대출**

암호화폐 보유자들은 투기적 이유 혹은 fiat 으로 전환할 때 세금을 회피하기 위해 팔지 않는다. 이럴 때 암호화폐를 담보로 대출해주는 서비스를 사용한다. 차입금은 과잉 담보로 DAI 에서 발행된다. DAI 는 달러에 고정되어 있기 때문에 시장에서 fiat 에 판매되거나 다른 암호화폐 투자에 사용될 수 있다.

**예치**

예치는 사용자가 스테이블코인을 스마트 컨트랙트로 잠그는 방식이다. 스마트 컨트랙트에 의해 화폐가 잠긴 결과 검증되는 트랜잭션이 없다는 점을 제외하면 스테이킹과 유사하다. 메이커는 DAI 에 대한 저축률을 가진 **DAI 예치 보상 컨트랙트(DSR)** 다.

**파생상품**

디파이에서 파생상품은 합성자산을 위한 담보로 사용된다. 예로 ERC-20 네트워크에서 BTC 나 금 등의 자산을 얻기 위해 ETH 를 활용한다.

---

### 탈중앙화 거래소

개발자는 스마트 컨트랙트를 통해 DEX 라고 알려진 탈중앙화 거래소를 구축할 수 있다. 탈중앙화 거래소에서 트레이더는 자신의 개인키를 가지고 암호화폐(랩드토큰)을 교환할 수 있도록 한다.

**탈중앙화 거래소와 중앙집중화 거래소**

탈중앙화 거래소의 목표는 교환 과정의 어떤 부분에도 중앙 집중 권한에 의존하지 않고 사용자에게 100% 기능을 제공하는 것이다. 이를 통해 보다 투명하고 안전하며 신뢰할 수 있는 서비스로 사용자는 언제든지 자금을 관리할 수 있다.

하지만 블록체인에 의해 속도와 확장성이 제한된다는 단점이 있는데, 사용자가 자금의 보관 권한을 유지하게 되면서 전반적인 경험이 복잡해지기 때문이다.

**거래소별 기반 인프라**

<p align="center">
    <img width="600" alt="Image" src="https://github.com/user-attachments/assets/3ce86b17-34f7-4ea0-a4c1-64c12dcfbe3c" />
</p>

**프론트엔드 차이점**

| **항목** | **중앙집중화 거래소** | **탈중앙화 거래소(유니스왑)** |
| --- | --- | --- |
| 유통 및 투명성 | 프론트엔드 코드는 거래소에 의해 비공개로 유지되며 거래소가 제어하는 인프라에서 실행된다. | 프론트엔드 코드는 유니스왑의 깃허브 저장소에서 공유된다. |
| 운영방식 | 프론트엔드는 인프라에서 거래소와 해당 호스팅 공급자 제어로 실행된다. | 커뮤니티 내 누구나 유니스왑과 상호작용하는 자체 웹사이트를 제작할 수 있다. |
| 기능 | 프론트엔드는 백엔드로부터 데이터를 수신한다（예: USD/ETH 시장의 환율을 취득한다）. 프론트엔드 코드는 예를 들어 거래를 실행하는 명령도 백엔드로 전송한다. | 프론트엔드 코드는 스마트 콘트랙트로부터 데이터를 수신한다. 명령은 백엔드로 전송되지
않는다.
대신 사용자는 메타마스크와 같은 이더리움 지갑을 사용해 클라이언트 기기에서 직접 스마트
콘트랙트로 전송한다.
프론트엔드 코드는 사용자에 대한 트랜잭션을 설정함으로써 프로세스를 보다 사용하기 쉽게 만든다. |
| 트랜잭션 승인 | 트랜잭션 허가는 프론트엔드 코드로 수행되며, 보통 쿠키 또는 액세스 토큰이 브라우저에 저장된다. | 사용자는 메타마스크에 저장된 개인키를 사용해 트랜잭션 서명을 생성한 다음 트랜잭션을 승인한다. 이후 메타마스크는 트랜잭션을 스마트 콘트랙트로 푸시한다. |

**백엔드 차이점**

| **항목** | **중앙집중화 거래소** | **탈중앙화 거래소(유니스왑)** |
| --- | --- | --- |
| 유통 및 투명성 | 백엔드 및 데이터베이스는 거래소에서 비공개로 유지된다. 일반인은 거래소의 코드를 감사할수 없다. | 백엔드 로직은 스마트 콘트랙트로 실행된다. 즉 유니스왑 거래소의 스마트 콘트랙트의 코드를 공개적으로 볼 수 있으므로 잠재적 사용자는 덱스를 사용하기 전에 코드를 감사할 수 있다. 모든 유니스왑 트랜잭션은 이더리움 블록체인에 기록되며, 또한 공개적으로 볼 수 있다. |
| 운영방식 | 백엔드는 거래소 및 호스팅 공급자가 제어하는 환경에서 실행된다. 거래소는 언제든지 백엔드 서버 또는 데이터베이스를 변경할 수 있다. 거래소, 호스팅 공급자는 언제든지 백엔드, 데이터베이스를 종료할 수 있다. | 유니스왑 스마트 콘트랙트와 트랜잭션은 수천 명의 마이너들에 의해 추진되고 기록된다. 스마트 콘트랙트와 트랜잭션은 불변이며 절대 변경할 수 없다. 스마트 콘트랙트를 종료하거나 트랜잭션을 삭제하려면 이더리움 네트워크를 종료하는 것이 유일한 방법이다. |
| 코드 실행 승인 | 비즈니스 로직을 실행하기 전에 백엔드는 JWT 또는 OAuth와 같은 보안 표준을 사용해 API 요청을 승인한다. | 스마트 콘트랙트 코드는 EVM（Ethernet Virtual Machine）에서 실행된다. 스마트 콘트랙트 블록을 생성하는 마이너의 노드 및 체인을 검증하고. 전체 노드를 실행하는 네
트워크의 모든 노드에서 실행된다. |

**거래소 타입 별 차이점**

| 항목 | 중앙집중화 거래소 | 탈중앙화 거래소 |
| --- | --- | --- |
|  | 토큰 제조사가 거래소에 토큰을 상장하려면 비즈니스 거래 조건을 협상해야 한다.
이때 토큰 제조사는 거래소의 책임을 줄이기 위해 상장 수수료를 지불하고 각종 법률 자료를 제공해야 한다. | 누구도 제어하지 않기 때문에 발행사는 토큰을 직접 상장시킬 수 있다.
ERC-20 토큰을 유니스왑에 등록하려면 유니스왑 토큰 팩토리 스마트 컨트랙트에서 `createExchange` 메서드를 호출하기만 하면 된다.
유니스왑 팩토리는 누구나 ETH 와 **SAI(ERC-20 스테이블토큰)** 를 교환할 수 있는 새로운 스마트 컨트랙트를 생성한다. |
| **커스터디 및 거래처 리스크** | 사용자는 거래하기 위해 암호화폐를 예치해야 하고, 거래소는 예치 자금을 보관한다.
거래소가 자금을 통제하기 때문에 해킹 혹은 폐쇄 시 사용자의 자금이 손실될 위험이 있다. | 스마트 컨트랙트가 입출금, 거래, 보관 및 유지를 관리한다.
따라서 사용자는 컨트랙트 코드를 감사해 자금의 사용방식을 알 수 있다. |
| **거래 환율** | 시장 거래의 환율은 매수자, 매도자가 모두 동의하는 가격으로 설정된다.
로직은 거래소의 백엔드 서버에 프로그래밍 되어 있다. | 환율은 거래를 실행하는 스마트 컨트랙트에 프로그래밍 되어 감사를 받을 수 있다. |
| **본인인증** | 모든 거래소는 사용자가 개인 식별 정보를 공유해야 하는 등록 프로세스가 있다.
KYC 는 정부가 거래소와 같은 금융 기관들의 돈세탁이나 테러 자금 조달 행위를 용이하게 하는 것을 막기 위한 중요한 방법이다.
 | 어떤 신원 정보도 공유하지 않고 누구나 거래를 할 수 있다. 여기서 공개되는 정보는 암호화폐 주소 뿐이다.
은행 시스템에 묶여있는 Fiat 은 지원하지 않는다. |
| **확장성** | 초당 수백만 건의 작업을 쉽고 빠르게 수행할 수 있는 잘 확립된 기술을 기반으로 인프라를 운영할 수 있다. | 퍼블릭 블록체인으로 동작하기 때문에 블록체인의 최대 트랜잭션 속도에 의해 제한된다. |

**이더리움 블록체인에 공개된 유니스왑 스마트 컨트랙트**

<p align="center">
    <img width="600" alt="Image" src="https://github.com/user-attachments/assets/e2dd60e9-ce50-4cff-9d72-e695b7459eb8" />
</p>

**`createExchange` 메서드 정의 예시**

<p align="center">
    <img width="600" alt="Image" src="https://github.com/user-attachments/assets/8b1ea4f1-a272-4abe-b655-0ce8ff2b6ca2" />
</p>

**유니스왑의 스마트 컨트랙트**

<p align="center">
    <img width="600" alt="Image" src="https://github.com/user-attachments/assets/39826c8f-f122-4a8b-a76f-fdf6b4518be7" />
</p>

---

### 플래시론

<p align="center">
    <img width="600" alt="Image" src="https://github.com/user-attachments/assets/a9058ce0-d3c9-4100-a01c-e5b8116823fa" />
</p>

**기존 대출과 플래시론의 차이점**

| **기존 대출** | **플래시론** |
| --- | --- |
| **신용평가 또는 담보 평가**를 통해 **차입자의 신용도와 대출 가능 금액**을 먼저 판단해야 한다.
일부 대출은 **담보물 제공**이 필수다.
**차입 기간이 길수록** 대출자가 **돈을 떼일 위험(신용 리스크)** 도 커진다. | **담보 없이 자금을 빌릴 수 있고,** **단 하나의 이더리움 트랜잭션 안에서만 사용 가능하다.**
빌린 돈과 **수수료를 같은 거래 내에서 즉시 상환**해야 한다. 
스마트 콘트랙트는 **여러 작업을 한 번에 처리**할 수 있어 빌린 자금을 동시에 돌려 줄 수 있기 때문에, 스마트 컨트랙트 차입 자금에 유용하다. |

**차익 거래를 위한 플래시론**

플래시론의 주요 적용 사례 중 하나는 여러 디파이 플랫폼 간에 가격 차이를 이용한 차익거래다. 가장 큰 이점은 **차익거래에 참여하는 거래소에 자산을 일시적으로 보유할 필요가 없다** 는 것이다.

일반적인 차익거래는 담보를 요구하고 유동성이 부족해 진입장벽이 높지만, 플래시론은 허가 요청 없이 여러 개의 대규모 유동성 풀에 실시간 접근이 가능해 담보없이 실행할 수 있어 속도와 유연성이 뛰어나다.

**풀크럼 플랫폼 해킹 사건**

2020년 2월, 디파이(DeFi) 프로토콜 bZx를 기반으로 한 풀크럼에서 발생한 플래시론(Flash Loan) 공격이다. 이 공격은 여러 디파이 플랫폼의 취약점을 이용하여 약 35만 달러 상당의 이더리움을 탈취한 사건으로, 디파이 생태계의 보안 문제를 부각시켰다.

<p align="center">
    <img width="600" alt="Image" src="https://github.com/user-attachments/assets/0f1abf09-5cbb-4bbc-9f2d-5721044c0b8e" />
</p>

- **공격 과정**
    1. **플래시론 실행 (차입)**
        1. 공격자는 dYdX 에서 담보 없이 10,000 ETH 를 플래시론으로 빌림
    2. **자산 분산**
        1. 5,500 ETH 를 Compound 에 예치하고, 이를 담보로 112 wBTC 를 대출받음
    3. **오라클(가격 피드) 환율 조작**
        1. 1,300 ETH 를 사용하여 Fulcrum 에서 ETH/wBTC 페어에 5배 레버리지 숏 포지션을 개설
        2. Fulcrum 의 거래는 Kyber 를 통해 유니스왑에서 실행되었고, 이로 인해 wBTC 의 가격이 급등함
    4. **새로운 환율로 거래**
        1. 이 가격 상승을 이용하여 공격자는 Compound 에서 빌린 112 wBTC 를 유니스왑에서 높은 가격에 판매하여 6,871 ETH 를 획득함
    5. **대출 상환 및 이익 확보**
        1. 처음에 빌린 10,000 ETH 를 dYdX 에 상환하고, 남은 약 1,193 ETH(당시 약 35만 달러)를 이익으로 확보함

### 프라이버시

블록체인에서 정보보호는 실험적 영역이기 때문에 다양한 솔루션이 등장했는데, 모네로, 제트캐시 같은 프라이버시 중심 블록체인이 출시되었다.

**영 지식 증명서 (Zero-Knowledge Proof)**

증명자가 검증자에게 진술이 참이라는 것을 증명하는 암호화 방법 또는 프로토콜이다. 이 접근 방식은 **사용자가 비밀이 무엇인지 검증자에게 밝힐 필요 없이** 유효한 비밀을 갖고 있음을 증명할 수 있다. 또한 서버는 아무것도 저장하지 않는다.

**신버스 SRP(Thinbus Secure Remote Password) 프로토콜로 가능한 작업**

- 서버는 임의로 생성된 솔트(Salt) 또는 추가적인 무작위 데이터와 암호 해독이 불가능한 검증기를 저장한다.
- 사용자가 로그인 할 때 특정 로그인에만 사용된 1회성 값을 보낸다. 로그인 시도 때마다 메시지는 달라진다. 서버는 SRP 를 통해 수신된 1회성 메시지가 유효한 암호를 가진 사용자에 의해 전송되었는지 확인할 수 있다.

<p align="center">
    <img width="600" alt="Image" src="https://github.com/user-attachments/assets/3cbca919-29e0-49e1-bba7-ea432957fc52" />
</p>

영 지식 증명을 블록체인에 구현하면 정보보호와 보안성이 크게 향상되지만, 다음과 같은 문제가 상당한 영향을 미칠 수 있다.

- 블록체인 마이너들은 전체 블록체인 히스토리의 복사본을 유지하며 네트워크 사용량이 증가함에 따라 크기가 더욱 커져 용량이 빠르게 늘어난다.
- 네트워크에서 당사자 간 상호작용이 필요한데, 발신인이 모든 마이너와 직접 소통하지 않기 때문에 문제가 된다. 마이너는 일대일 상호작용을 수반하지 않는 프로세스인 거래를 검증한다.

**비인터랙티브 지식 논쟁 (zk-SNARKs)**

증명의 크기가 매우 작고, 검증 시간이 빠르면서 상호작용이 필요없이 한번의 메시지로 증명이 가능한 영 지식 증명의 한 형태이다.

제트캐시와 같은 네트워크에서 이미 사용되고 있고, 또한 Rollup (ZK-Rollup) 과 같은 솔루션으로 이더리움 네트워크에서 프라이빗 트랜잭션을 허용할 수 있다.

**링 서명** 

미리 정의된 그룹의 누구나 트랜잭션에 서명할 수 있어 실제 서명자의 신원을 파악하는데 어려움을 줄 수 있다. 구성원 중 한 명이 거래를 전송해 발신인을 숨기고 개인정보를 보호할 수 있다. 모네로 코인은 UTXO 를 숨기기 위해 혼란 유발 코인 출력 (decoy outputs) 을 사용하는 것 이외에도 링 서명 기술을 사용하고 있다.
